@page "/employees/edit/{id:int}"
@inject IClientService ClientService
@inject NavigationManager Navigation
@inject ISnackbar Snackbar

<PageTitle>تعديل الموظف</PageTitle>

<MudContainer MaxWidth="MaxWidth.Small">
    <MudText Typo="Typo.h4" Class="mb-4">تعديل بيانات الموظف</MudText>
    
    @if (employee == null)
    {
         <MudProgressCircular Color="Color.Primary" Indeterminate="true" />
    }
    else
    {
        <MudCard>
            <MudCardContent>
                <EditForm Model="@employee" OnValidSubmit="HandleValidSubmit">
                    <DataAnnotationsValidator />
                    
                    <MudGrid>
                        <MudItem xs="12">
                            <MudTextField Label="الاسم الكامل" @bind-Value="employee.FullName" For="@(() => employee.FullName)" Variant="Variant.Outlined" Margin="Margin.Dense" />
                        </MudItem>
                        <MudItem xs="12" md="6">
                            <MudTextField Label="رقم التوظيف" @bind-Value="employee.EmploymentNumber" For="@(() => employee.EmploymentNumber)" Variant="Variant.Outlined" Margin="Margin.Dense" />
                        </MudItem>
                        <MudItem xs="12" md="6">
                            <MudTextField Label="البريد الإلكتروني" @bind-Value="employee.Email" For="@(() => employee.Email)" Variant="Variant.Outlined" Margin="Margin.Dense" InputType="InputType.Email" />
                        </MudItem>
                        <MudItem xs="12">
                             <MudTextField Label="القسم" @bind-Value="employee.Department" For="@(() => employee.Department)" Variant="Variant.Outlined" Margin="Margin.Dense" />
                        </MudItem>
                        <MudItem xs="12">
                             <MudTextField Label="المسمى الوظيفي" @bind-Value="employee.JobTitle" For="@(() => employee.JobTitle)" Variant="Variant.Outlined" Margin="Margin.Dense" />
                        </MudItem>
                    </MudGrid>
                    
                    <div class="d-flex justify-end mt-4">
                         <MudButton ButtonType="ButtonType.Submit" Variant="Variant.Filled" Color="Color.Success" Class="ml-2">حفظ التعديلات</MudButton>
                         <MudButton Variant="Variant.Text" Color="Color.Secondary" Href="employees">إلغاء</MudButton>
                    </div>
                </EditForm>
            </MudCardContent>
        </MudCard>
    }
</MudContainer>

@code {
    [Parameter]
    public int Id { get; set; }

    private Employee? employee;

    protected override async Task OnInitializedAsync()
    {
        employee = await ClientService.GetEmployeeByIdAsync(Id);
    }

    private async Task HandleValidSubmit()
    {
        if (employee != null)
        {
            await ClientService.UpdateEmployeeAsync(Id, employee);
            Snackbar.Add("تم تعديل البيانات بنجاح", Severity.Success);
            Navigation.NavigateTo("employees");
        }
    }
}
